<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Room2Music</title>
  <style>
    :root { --bg:#f8fafc; --fg:#0f172a; --muted:#475569; --card:#fff; --border:#e2e8f0; --accent:#0f172a; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Noto Sans,"Helvetica Neue",Arial;color:var(--fg);background:linear-gradient(#fff,var(--bg))}
    .container{max-width:1040px;margin:0 auto;padding:24px}
    .hero{display:grid;grid-template-columns:1fr;gap:24px;padding:32px 0}
    @media(min-width:900px){.hero{grid-template-columns:1fr 1fr;align-items:center}}
    h1{font-size:clamp(28px,4vw,48px);margin:0 0 12px;font-weight:900}
    p.lead{font-size:18px;color:var(--muted);line-height:1.7}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:16px;padding:12px 18px;text-align: center;text-decoration:none;font-weight:600;border:1px solid var(--border)}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn:hover{filter:brightness(.96)}
    .btn[disabled]{opacity:.5;pointer-events:none}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .card.pad{padding:24px}
    .imgbox{aspect-ratio:16/9;width:100%;overflow:hidden;border-radius:0;border:none}
    .imgbox img{width:100%;height:100%;object-fit:cover;display:block}
    .pills{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .pill{border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:#334155;background:#f8fafc}

    .progress{width:100%;height:8px;border-radius:999px;background:#e2e8f0;overflow:hidden}
    .progress>div{height:100%;background:var(--accent);width:0%;transition:width .25s ease}

    .options{display:grid;gap:12px}
    .option{ text-align:left;border:1px solid var(--border);border-radius:16px;padding:14px;background:#fff;cursor:pointer;display:flex;gap:12px;align-items:flex-start;box-shadow:0 1px 4px rgba(0,0,0,.04)}
    .option:hover{border-color:#cbd5e1}
    .option.selected{background:#0f172a;color:#fff;border-color:#0f172a}
    .option .num{width:24px;height:24px;border-radius:50%;border:1px solid #cbd5e1;display:inline-flex;align-items:center;justify-content:center;font-size:12px;background:#f1f5f9;color:#334155;margin-top:2px}
    .option.selected .num{background:#fff;color:#0f172a;border-color:transparent}

    .quiz-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:12px}

    .result-grid{display:grid;gap:24px;grid-template-columns:1fr}
    @media(min-width:900px){.result-grid{grid-template-columns:1fr 1fr}}
    .teacher-photo{width:100%;height:260px;object-fit:cover;border-bottom:1px solid var(--border);display:block}
    
    /* è®“æ¯å€‹ runner é …ç›®å…§éƒ¨æ›´å¹³è¡¡ */
    .runner {
      flex-direction: column; /* è®“åœ–ç‰‡å’Œæ–‡å­—ä¸Šä¸‹æ’åˆ— */
      align-items: center; /* æ°´å¹³å±…ä¸­ */
      text-align: center; /* æ–‡å­—ä¹Ÿå±…ä¸­ */
      gap: 8px; /* åœ–ç‰‡å’Œæ–‡å­—ä¹‹é–“çš„é–“è· */
    }

    /* èª¿æ•´åœ–ç‰‡å°ºå¯¸ */
    .runner img {
      width: 90px;
      height: 90px;
      border-radius: 12px; /* æ”¹æˆåœ“å½¢åœ–ç‰‡ï¼Œæ›´å…·è¨­è¨ˆæ„Ÿ */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* è¼•å¾®é™°å½±ï¼Œå¢åŠ ç«‹é«”æ„Ÿ */
    }

    /* èª¿æ•´æ–‡å­—æ¨£å¼ */
    .runner .name {
      font-size: 18px; /* è®“åå­—æ›´çªå‡º */
      font-weight: 600;
    }
    .runner .muted {
      font-size: 14px; /* æ¨‚å™¨åç¨±ç¶­æŒå°ä¸€é» */
    }

    .muted{color:var(--muted)}
    .fade-enter{opacity:0;transform:translateX(24px)}
    .fade-enter.active{opacity:1;transform:translateX(0);transition:all .2s ease}
    .fade-exit{opacity:1;transform:translateX(0)}
    .fade-exit.active{opacity:0;transform:translateX(-24px);transition:all .2s ease}


    /* === èƒŒæ™¯ === */
    body {
      background: radial-gradient(circle at top, #1a1a2e, #0a0a0a 70%);
      color: #fff;
      font-family: "Noto Sans TC", sans-serif;
    }

    /* æµ®å‹•éŸ³ç¬¦ + è²“å’ª */
    .floating-icons {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    .floating-icons span {
      position: absolute;
      font-size: 24px;
      color: rgba(233,30,99,0.5); /* ç²‰ç´…äº®è‰² */
      animation: floatAnim 12s linear infinite;
    }
    @keyframes floatAnim {
      0%   { transform: translateY(100vh) scale(0.8); opacity: 0; }
      20%  { opacity: 1; }
      100% { transform: translateY(-20vh) scale(1.2); opacity: 0; }
    }

    /* èª¿æ•´æ–‡å­—é¡è‰² */
    p, label, input, textarea {
      color: #f5f5f5;
    }
    .muted {
      color: #ccc !important;
    }

    /* å¡ç‰‡ */
    .card {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      color: #fff;
    }

    /* æŒ‰éˆ• */
    .btn.primary {
      background: linear-gradient(90deg, #e91e63, #8e24aa);
      color: #fff;
      border: none;
      box-shadow: 0 0 10px rgba(233,30,99,0.6);
    }
    .btn.primary:hover {
      box-shadow: 0 0 16px rgba(233,30,99,0.9);
      transform: scale(1.05);
    }

    .btn.second {
      background: linear-gradient(45deg, #917884, #b4a5a0);
      color: #fff;
      border: none;
      box-shadow: 0 0 10px rgba(255, 105, 180, 0.4);
    }
    .btn.second:hover {
      box-shadow: 0 0 16px rgba(255, 105, 180, 0.6);
      transform: translateY(-2px); /* å‘ä¸Šè¼•å¾®ç§»å‹•ï¼Œæä¾›ã€ŒæŠ¬èµ·ã€çš„å‹•æ…‹æ„Ÿ */
    }
    #retryBtn:hover {
      box-shadow: 0 0 16px rgba(120, 120, 120, 0.6); /* èª¿æ•´ç‚ºç°è‰²èª¿çš„é™°å½± */
      transform: translateY(-2px);
    }

    /* é¸é … */
    .option {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
    }
    .option:hover {
      background: rgba(233,30,99,0.2);
    }
    .option.selected {
      background: linear-gradient(90deg, #ff9a9e, #e91e63);
      color: #fff;
      font-weight: bold;
    }

    input, textarea {
      color: #333; /* é€™æœƒè®“ä½¿ç”¨è€…è¼¸å…¥çš„æ–‡å­—è®Šæˆæ·±ç°è‰² */
    }

    .action-buttons {
      display: flex;
      justify-content: center; /* ç½®ä¸­ */
      gap: 16px; /* æŒ‰éˆ•é–“è· */
      margin-top: 24px;
      width: calc(100% - 40px); /* å·¦å³å„ç•™ 20px é–“è· */
      margin-left: auto;
      margin-right: auto;
    }
    /* è®“æŒ‰éˆ•å€‘å¹³åˆ†ç©ºé–“ */
    .action-buttons .btn {
      flex: 1;
      /* æ‚¨å¯ä»¥ç§»é™¤åŸæœ‰çš„ paddingï¼Œè‹¥æƒ³çµ±ä¸€å¤§å°ï¼Œçµ±ä¸€è¨­å®š width ä¹Ÿå¯ä»¥ */
      /* padding: 12px 18px; */
      /* min-width: 0;  å¦‚æœæŒ‰éˆ•å…§å®¹éé•·ï¼Œéœ€è¦é€™è¡Œä¾†ç¢ºä¿ flex: 1 èƒ½ç”Ÿæ•ˆ */
    }
    @media (max-width: 768px) { /* æ ¹æ“šæ‚¨çš„è¨­è¨ˆæ–·é»èª¿æ•´ */
      .action-buttons {
        flex-direction: column;
        width: calc(100% - 40px); /* ä¿æŒå¯¬åº¦ */
        margin-left: 20px;
        margin-right: 20px;
      }
      .action-buttons .btn {
        flex: none; /* ç§»é™¤ flex: 1 */
        width: 100%; /* ä½”æ»¿å¯¬åº¦ */
        margin: 8px 0; /* åœ¨å †ç–Šæ™‚å¢åŠ å‚ç›´é–“è· */
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Hero -->
    <section class="hero">
      <div>
      <!--  <h1>Room2Music</h1>-->
        <h1>è²³é¤¨éŸ³æ¨‚</h1>
          <p style="color: white;">æ‰¾åˆ°ä½ çš„æ¨‚å™¨ï¼Œé‡è¦‹é©åˆä½ çš„è€å¸«ï¼Œè®“éŸ³æ¨‚èå…¥ç”Ÿæ´»ï¼<br>ä¸è«–ä½ çš„ç›®æ¨™æ˜¯ä»€éº¼ï¼Œæˆ‘å€‘éƒ½èƒ½ç‚ºä½ ç²¾æº–é…å°æœ€é©åˆçš„è€å¸«èˆ‡èª²ç¨‹ã€‚</p>        <div style="display:flex;gap:12px;margin-top:16px">
          <a href="#quiz" class="btn primary" id="startQuiz">é–‹å§‹ 60 ç§’é…å°</a>
          <a href="#contact" class="btn second">è¯çµ¡æˆ‘å€‘</a>
        </div>
      </div>
      <div>
        <div class="imgbox">
          <img src="../../photo/room2logo.png" alt="Music classroom">
        </div>
        <div class="pills">
          <span class="pill">é›»/æœ¨å‰ä»–</span><span class="pill">æµè¡Œ/çˆµå£«</span><span class="pill">æª¢å®š/æ¯”è³½</span><span class="pill">å…’ç«¥å‹å–„</span>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about" class="card pad" style="margin:28px 0">
      <h3 style="margin:0 0 10px;font-size:22px;font-weight:800">é—œæ–¼ Room2Music</h3>
      <div style="line-height:1.7; color:#f5f5f5;">
        <p style="font-weight:bold; font-size:18px;">
          ğŸµğŸ¶è²³é¤¨éŸ³æ¨‚ï¼šå¯¦ç¾ä½ çš„éŸ³æ¨‚å¤¢æƒ³ğŸ¶ğŸµ
        </p>
        <p>
          Room2Musicè‡´åŠ›æ–¼é»ç‡ƒæ¯ä¸€ä½å­¸å“¡å°éŸ³æ¨‚çš„ç†±æƒ…ï¼ŒçŒ¶å¦‚å¿ƒè‡Ÿèˆ¬å¼·è€Œæœ‰åŠ›åœ°é¼“å‹•è‘—ã€‚
        </p>
        <p>
          é€™è£¡æä¾›å¤šå…ƒåŒ–çš„éŸ³æ¨‚æ•™å­¸ï¼Œå¾æ¨‚å™¨å…¥é–€åˆ°é€²éšæ¼”å¥ï¼Œéƒ½èƒ½è®“ä½ æ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„ç¯€å¥ã€‚ä¸è«–ä½ æ˜¯æƒ³å­¸ç¿’å‰ä»–ã€è²æ–¯ã€çˆµå£«é¼“ï¼Œæˆ–æ˜¯æŒ‘æˆ°å…¶ä»–æ¨‚å™¨ï¼Œè²³é¤¨éŸ³æ¨‚éƒ½å°‡é™ªä¼´ä½ æ¢ç´¢éŸ³æ¨‚çš„ç„¡é™å¯èƒ½ã€‚
        </p>
        <p style="font-weight:bold; margin-top:20px;">
          ğŸ“æˆ‘å€‘çš„æ•™å­¸æ“šé»ï¼š
        </p>
        <ul style="list-style-type:none; padding:0; margin:0;">
          <li>å˜‰ç¾©å¸‚æ±å€å­¸åºœè·¯</li>
          <li>å°å—å¸‚æ±å¯§è·¯è¥¿æ®µ22è™ŸB1</li>
          <li>é«˜é›„å¸‚æ–°èˆˆå€ä¸­æ­£ä¸‰è·¯127è™Ÿ</li>
        </ul>
        <p style="margin-top:20px;">
          æ–¹ä¾¿ä½ éš¨æ™‚åŠ å…¥æˆ‘å€‘çš„éŸ³æ¨‚å¤§å®¶åº­ã€‚
        </p>
        <p style="font-weight:bold; margin-top:20px;">
          âœ¨ æ›´å¤šè©³ç´°å…§å®¹ï¼Œè¿½è¹¤æˆ‘å€‘ä¸‹åˆ—è¯çµ¡æ–¹å¼ï¼éš¨æ™‚æŒæ¡æœ€æ–°èª²ç¨‹è³‡è¨Šèˆ‡æ´»å‹•å‹•æ…‹ï¼
        </p>
      </div>
    </section>

    <!-- Quiz -->
    <section id="quizSection" class="card pad" style="display:none">
      <div style="margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;font-size:14px;color:var(--muted);margin-bottom:8px">
          <span style="color: rgb(182, 181, 181);">é€²åº¦</span><span style="color: rgb(182, 181, 181)", id="progressText" >1 / 11ï¼ˆ0%ï¼‰</span>
        </div>
      <div class="progress" style="background-color: #e0e0e0;">
        <div id="progressBar" style="background-color: #a04857; width: 50%;"></div>
      </div>
      </div>
      <div id="questionWrap"></div>
      <div class="quiz-nav">
        <button class="btn" id="prevBtn">ä¸Šä¸€é¡Œ</button>
        <button class="btn primary" id="nextBtn">ä¸‹ä¸€é¡Œ</button>
      </div>
    </section>

    <!-- Result -->
    <section id="resultSection" style="display:none; padding: 20px;">
      <div style="max-width: 900px; margin: 0 auto; display:grid; gap:24px; grid-template-columns:1fr;">
        <div class="card pad" style="text-align:center;">
          <h3 style="margin:0 0 10px;font-size:24px;font-weight:700">æœ€é©åˆä½ çš„è€å¸«</h3>
          <div id="topPhotoContainer" style="width: 100%; aspect-ratio: 16/9; margin-bottom: 16px; overflow: hidden; border-radius: 12px;">
            <img id="topPhoto" src="" alt="æœ€é©åˆä½ çš„è€å¸«" style="width: 100%; height: 100%; object-fit: contain; background-color: #000;">
          </div>
          <h4 id="topName" style="margin:0 0 6px;font-size:24px;font-weight:800;"></h4>
          <div id="topTags" class="pills" style="justify-content:center; margin-bottom: 20px;"></div>
          <p id="topBio" class="muted" style="line-height:1.7;"></p>
          <div class="action-buttons">
            <button class="btn primary" id="submitBtn" style="justify-content:center;">é€å‡ºå•å·</button>
            <button class="btn" id="retryBtn" style="justify-content:center;">é‡æ–°æ¸¬ä¸€æ¬¡</button>
          </div>     
        </div>

        <div class="card pad">
          <h4 style="margin:0 0 10px;font-size:20px;font-weight:700">æ¬¡ä½³äººé¸</h4>
          <p class="muted" style="font-size:12px;margin-top:12px">* è‹¥æœ€é©åˆçš„æ™‚æ®µæ»¿ç­ï¼Œä»¥ä¸‹è€å¸«ä¹Ÿéå¸¸å¥‘åˆä½ çš„å­¸ç¿’åå¥½ã€‚</p>

          <div id="runnerList" style="display:flex;justify-content: space-around; /* æˆ– space-between, center */align-items: flex-start;gap: 20px; /* å¢åŠ ä¸¦åˆ—é …ç›®ä¹‹é–“çš„é–“è· */"></div>
        </div>
      </div>
    </section>

    <!-- Contactï¼ˆé¡åƒ Google è¡¨å–®ï¼‰
    <form id="gform"
          class="card pad"
          style="margin:28px 0 10px"
          action="#"
          method="POST">

      <h3 style="margin:0 0 10px;font-size:22px;font-weight:800">è¯çµ¡æˆ‘å€‘</h3>
      <p class="muted" style="margin-top:0">åœ°å€ï¼šå°å—å¸‚æ±å€æ±å¯§è·¯è¥¿æ®µ22è™Ÿï½œé›»è©±ï¼š(06)236-7528ï½œFBï¼šè²³é¤¨éŸ³æ¨‚</p>

      <div style="display:grid;gap:16px;grid-template-columns:1fr">
        <div>
          <label class="muted" style="font-size:14px">ä½ çš„å§“å</label>
          //å§“åï¼šentry.465133692
          <input id="nameInput"
                name="entry.465133692"
                placeholder="ç‹å°æ˜" required
                style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border)">
        </div>

        <div>
          <label class="muted" style="font-size:14px">è¯çµ¡æ–¹å¼ï¼ˆEmail / æ‰‹æ©Ÿï¼‰</label>
          <!-- è¯çµ¡æ–¹å¼ï¼šentry.331042393
          <input id="contactInput"
                name="entry.331042393"
                placeholder="example@gmail.com" required
                style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border)">
        </div>

        <div>
          <label class="muted" style="font-size:14px">æƒ³å­¸çš„å…§å®¹/å‚™è¨»</label>
          <!-- å‚™è¨»ï¼šentry.90522651
          <textarea id="noteInput"
                    name="entry.90522651"
                    placeholder="ä¾‹å¦‚ï¼šæƒ³å­¸æµè¡Œé‹¼ç´ã€ä¸Šèª²æ™‚é–“åå¥½é€±æœ«..."
                    style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);height:120px"></textarea>
        </div>
        <div>
          <button type="submit" class="btn primary" style="width:100%;justify-content:center">é€å‡ºç•™è¨€</button>
          <p class="muted" style="font-size:12px;margin-top:8px">
            æœ¬é é¢ç‚ºè³‡æ–™é€é Google Apps Script å®‰å…¨å¯«å…¥ä½ çš„ Google è©¦ç®—è¡¨ã€‚
          </p>
          <div id="contactStatus" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <div style="text-align:center;color:#6b7280;font-size:13px;margin-top:20px">
        Â© <span id="year"></span> room2Music â€” è®“å­¸éŸ³æ¨‚è®Šå¾—æ›´è¼•é¬†ã€‚
      </div>
    </form> -->


  </div>

  <!-- å¤–éƒ¨è³‡æ–™æª” -->
  <script src="assets/data/quiz_data.js"></script>

  <!-- ä¸»ç¨‹å¼ -->
  <script>
    const { questions, teachers } = window.quizData;

    // ========= ç‹€æ…‹ =========
    const $ = (s) => document.querySelector(s);
    const quizSection = $('#quizSection');
    const resultSection = $('#resultSection');
    const startQuizBtn = $('#startQuiz');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const progressBar = $('#progressBar');
    const progressText = $('#progressText');
    const questionWrap = $('#questionWrap');

    const total = questions.length;
    let step = 0;       // 0=hero, 1=quiz, 2=result
    let current = 0;    // ç›®å‰é¡Œè™Ÿ index
    // ç­”æ¡ˆé™£åˆ—ï¼šå–®é¸å­˜æ•¸å­— indexï¼›è¤‡é¸å­˜é™£åˆ— [index, index]
    let answers = questions.map(q => q.multiple ? [] : null);
    // ğŸ¯ æ¨‚å™¨åˆ†æµæ¬Šé‡ï¼ˆå¯è‡ªè¡Œå¾®èª¿ï¼‰
    const INSTRUMENT_WEIGHT_EXACT = 3;   // åŒå‹ï¼ˆä¾‹ï¼šé¸é›»å‰ä»– + é›»å‰ä»–è€å¸«ï¼‰
    const INSTRUMENT_WEIGHT_CROSS = 1;   // è·¨å‹ï¼ˆä¾‹ï¼šé¸é›»å‰ä»– + æœ¨å‰ä»–è€å¸«ï¼‰
    const INSTRUMENT_PREF_BONUS   = 2;   // è€å¸«åœ¨ preferences[1] åå¥½ä½ çš„æ¨‚å™¨ï¼Œå†åŠ æˆ
    const GUITAR_SET = new Set(["é›»å‰ä»–", "æœ¨å‰ä»–"]);
    

    // ========= UI =========
    function showSection(which){
      quizSection.style.display = which === 1 ? 'block' : 'none';
      resultSection.style.display = which === 2 ? 'block' : 'none';
    // é¡å¤–æ§åˆ¶ About é¡¯ç¤º/éš±è—
      const about = document.getElementById('about');
      if (about) {
        about.style.display = (which === 0) ? 'block' : 'none';
      }
      step = which;
    }

    function updateProgress(){
      const percent = Math.round(((current + 1) / total) * 100);
      progressBar.style.width = percent + '%';
      progressText.textContent = `${current + 1} / ${total}ï¼ˆ${percent}%ï¼‰`;
    }

    function renderQuestion(){
      updateProgress();
      const q = questions[current];
      questionWrap.innerHTML = '';

      const wrap = document.createElement('div');
      wrap.className = 'fade-enter';

      if (q.fields) {
        wrap.innerHTML = `
          <h2 style="margin:0 0 12px;font-size:24px;font-weight:800;">${q.title}</h2>
          <div style="display:grid;gap:16px;">
            ${q.fields.map(f => {
              if (f.type === "text") {
                return `
                  <div>
                    <label class="muted" style="font-size:14px">${f.label}</label>
                    <input data-field="${f.id}" placeholder="${f.placeholder}"
                      style="margin-top:6px;width:100%;padding:10px 12px;
                      border-radius:12px;border:1px solid var(--border)">
                  </div>`;
              } else if (f.type === "radio") {
                return `
                  <div>
                    <label class="muted" style="font-size:14px">${f.label}</label>
                    <div style="margin-top:6px;display:flex;gap:12px;">
                      ${f.options.map(opt => `
                        <label>
                          <input type="radio" name="${f.id}" value="${opt}" data-field="${f.id}">
                          ${opt}
                        </label>
                      `).join('')}
                    </div>
                  </div>`;
              } else if (f.type === "textarea") {
                return `
                  <div>
                    <label class="muted" style="font-size:14px">${f.label}</label>
                    <textarea data-field="${f.id}" placeholder="${f.placeholder}"
                      style="margin-top:6px;width:100%;padding:10px 12px;
                      border-radius:12px;border:1px solid var(--border);height:120px"></textarea>
                  </div>`;
              }
            }).join('')}
          </div>
        `;

      // ğŸŸ¢ æŠŠè¼¸å…¥æ¡†çš„å€¼åŒæ­¥å­˜é€² answers[current]
      requestAnimationFrame(() => {
        const inputs = wrap.querySelectorAll("[data-field]");
        inputs.forEach(el => {
          if (el.type === "radio") {
            el.addEventListener("change", () => {
              answers[current] = answers[current] || {};
              answers[current][el.name] = el.value;
            });
          } else {
            el.addEventListener("input", () => {
              answers[current] = answers[current] || {};
              answers[current][el.getAttribute("data-field")] = el.value;
            });
          }
        });
      });

      } else if (q.options) {
        wrap.innerHTML = `
          <h2 style="margin:0 0 12px;font-size:24px;font-weight:800;">${q.title}</h2>
          <div class="options">
            ${q.options.map((label, i) => `
              <button class="option ${answers[current]===i?'selected':''}" data-index="${i}">
                <span class="num">${i+1}</span>
                <span>${label}</span>
              </button>
            `).join('')}
          </div>
        `;

        const optionButtons = wrap.querySelectorAll('.option');
        optionButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            const i = Number(btn.getAttribute('data-index'));
            if (q.multiple) {
              const arr = Array.isArray(answers[current]) ? [...answers[current]] : [];
              const pos = arr.indexOf(i);
              if (pos === -1) arr.push(i); else arr.splice(pos, 1);
              answers[current] = arr;
              btn.classList.toggle('selected');
            } else {
              answers[current] = i;
              optionButtons.forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');
            }
          });
        });
      }

      questionWrap.appendChild(wrap);
      requestAnimationFrame(()=>{ wrap.className = 'fade-enter active'; });
    }

    

    // ========= é…å°æ¼”ç®—æ³• =========
    // è¦å‰‡ï¼šæ¯ä¸€é¡Œï¼Œåªè¦ã€Œå­¸å“¡ç­”æ¡ˆã€åŒ…å«åœ¨è€å¸«è©²é¡Œçš„å¯æ¥å—æ¸…å–®ï¼Œå°±åŠ  1 åˆ†ã€‚
    // è¤‡é¸é¡Œï¼šæ¯å€‹ç¬¦åˆçš„é¸é …å„åŠ  1 åˆ†ï¼ˆå¤šé¸å¤šå¾—ï¼‰ã€‚
   function computeScores(){
      // ç¬¬ 1 é¡Œï¼ˆæ¨‚å™¨ï¼‰ä½œç‚ºåˆ†æµå‰æ
      const ansInstrumentIdx = answers[1]; // q1 ä¸€å®šæ˜¯ç¬¬ä¸€é¡Œ
      const instrumentLabel = ansInstrumentIdx != null ? questions[1].options[ansInstrumentIdx] : null;

      // å…ˆä¾æ¨‚å™¨æŒ‘å‡ºå€™é¸è€å¸«
      const candidates = teachers.filter(t => {
        if (!instrumentLabel) return true; // ç†è«–ä¸Šä¸æœƒç™¼ç”Ÿï¼ˆä¸‹ä¸€é¡Œå‰æœƒé–å®šï¼‰
        if (GUITAR_SET.has(instrumentLabel)) {
          // å‰ä»–çµ„ï¼šå…©é‚Šè€å¸«éƒ½å¯æ•™
          return GUITAR_SET.has(t.instrument);
        } else {
          // å…¶ä»–æ¨‚å™¨ï¼šè€å¸«å¿…é ˆèƒ½æ•™è©²æ¨‚å™¨æ‰ç´å…¥
          const canTeach = Array.isArray(t.canTeach)
            ? t.canTeach.includes(instrumentLabel)
            : (t.instrument === instrumentLabel);
          return canTeach;
        }
      });

      // å°å€™é¸è€å¸«è¨ˆåˆ†
      const scoreList = candidates.map(t => {
        let score = 0;

        // 1) æ¨‚å™¨åŠ æ¬Šï¼ˆåªåœ¨æœ‰é¸ç¬¬ 1 é¡Œæ™‚ï¼‰
        if (instrumentLabel) {
          // åŒ/è·¨å‹åŠ æ¬Š
          if (GUITAR_SET.has(instrumentLabel)) {
            score += (t.instrument === instrumentLabel)
              ? INSTRUMENT_WEIGHT_EXACT
              : INSTRUMENT_WEIGHT_CROSS;
          } else {
            // éå‰ä»–ï¼šå€™é¸éƒ½å·²èƒ½æ•™ -> çµ¦åŒå‹é«˜åˆ†
            score += (t.instrument === instrumentLabel)
              ? INSTRUMENT_WEIGHT_EXACT
              : INSTRUMENT_WEIGHT_CROSS; // ä½ ä¹Ÿå¯è¨­ç‚º 0
          }
          // åå¥½åŠ æˆï¼šè€å¸«åœ¨ç¬¬ 1 é¡Œ preferences å…§åŒ…å«æ­¤æ¨‚å™¨é¸é …ï¼ˆ1-basedï¼‰
          const pref1 = t.preferences?.[1];
          if (pref1 && pref1.includes(ansInstrumentIdx + 1)) {
            score += INSTRUMENT_PREF_BONUS;
          }
        }

        // 2) å…¶ä»–é¡Œï¼ˆ2ï½9ï¼‰ç…§èˆŠåŠ åˆ†ï¼›ç¬¬ 1 é¡Œä¸å†ç•¶ä¸€èˆ¬é¡Œç›®è¨ˆåˆ†
        questions.forEach((q, qi) => {
          if (q.id === 1) return; // è·³éæ¨‚å™¨é¡Œ
          const accept = t.preferences[q.id];
          if (!accept) return;
          const ans = answers[qi];
          if (q.multiple) {
            (ans || []).forEach(idx => {
              if (accept.includes(idx + 1)) score += 1;
            });
          } else {
            if (ans != null && accept.includes(ans + 1)) score += 1;
          }
        });

        return { id: t.id, score };
      });

      // ä¾åˆ†æ•¸æ’åºï¼ˆè‹¥å®Œå…¨æ²’æœ‰å€™é¸ï¼Œå›å‚³ç©ºé™£åˆ—ï¼‰
      scoreList.sort((a,b) => b.score - a.score);
      return scoreList;
    }


    function renderResult(){
      const ranking = computeScores();
      const top = teachers.find(t => t.id === ranking[0]?.id);
      const ansInstrumentIdx = answers[1];  //ä¿®æ­£:å› æ–°å¢ç¬¬ä¸€é¡Œæ˜¯ã€ŒåŸºæœ¬è³‡è¨Šã€ï¼Œç¬¬äºŒé¡Œæ˜¯ã€Œæ¨‚å™¨ç¨®é¡ã€
      const instrumentLabel = ansInstrumentIdx != null ? questions[1].options[ansInstrumentIdx] : null;
      // Top
      const topPhoto = $('#topPhoto');
      const topName = $('#topName');
      const topBio  = $('#topBio');
      const topTags = $('#topTags');

      // è‹¥æ²’æ‰¾åˆ°è€å¸«ï¼Œçµ¦å‡ºé‡å°æ€§èªªæ˜
      if (!top) {

        if (topName) topName.textContent = 'æš«ç„¡å°æ‡‰è€å¸«';
        if (topBio)  topBio.textContent  = instrumentLabel
          ? `ç›®å‰å°šç„¡ã€Œ${instrumentLabel}ã€å°æ‡‰çš„è€å¸«ï¼Œæ­¡è¿å…ˆç•™è¨€ï¼Œæˆ‘å€‘æœƒå”åŠ©å®‰æ’æˆ–æ¨è–¦ã€‚`
          : 'ç›®å‰æš«ç„¡æ¨è–¦ï¼Œè«‹èª¿æ•´ä½œç­”æ¢ä»¶å†è©¦ä¸€æ¬¡ã€‚';
      }
      const runners = ranking.slice(1,3).map(r => teachers.find(t => t.id === r.id));



      topPhoto.src = top?.photo || 'https://placehold.co/600x400?text=No+Recommended+Teachers';
      topPhoto.alt = top?.name || 'æœ€ä½³è€å¸«';
      topName.textContent = top?.name || 'æš«ç„¡æ¨è–¦';
      topBio.textContent  = top
        ? `æˆèª²æ¨‚å™¨ï¼š${top.instrument}ï½œï¼ˆå¯è¯çµ¡æˆ‘å€‘å®‰æ’é«”é©—èª²ï¼‰`
        : 'è«‹èª¿æ•´ä½ çš„ä½œç­”æ¢ä»¶å†è©¦ä¸€æ¬¡ã€‚';
      topTags.innerHTML = '';


      // é€™è£¡å¯è‡ªç”±æ”¾æ¨™ç±¤ï¼ˆç¤ºæ„ï¼šè€å¸«æ¨‚å™¨èˆ‡æ€§åˆ¥ï¼‰
      if (top){
        ["#"+top.instrument, top.gender ? "æ€§åˆ¥ï¼š"+top.gender : null]
          .filter(Boolean)
          .forEach(tag=>{
            const el = document.createElement('span');
            el.className = 'pill';
            el.textContent = tag;
            topTags.appendChild(el);
          });
      }

      // Runners
      const runnerList = $('#runnerList');
      runnerList.innerHTML = '';
      runners.forEach(r => {
        if (!r) return;
        const row = document.createElement('div');
        row.className = 'runner';
        row.innerHTML = `
          <img src="${r.photo || 'https://placehold.co/96x96?text=T'}" alt="${r.name}">
          <div>
            <div style="font-weight:600">${r.name}</div>
            <div class="muted" style="font-size:13px">æˆèª²æ¨‚å™¨ï¼š${r.instrument}</div>
          </div>`;
        runnerList.appendChild(row);
      });
    }

    // ========= å°èˆª =========
    function next(){

      const q = questions[current];

      // å¦‚æœé€™ä¸€é¡Œæ˜¯ fieldsï¼Œè¦æŠŠè¼¸å…¥å€¼æ”¶é€² answers[current]
      if (q.fields) {
        answers[current] = answers[current] || {};
        q.fields.forEach(f => {
          if (f.type === "radio") {
            const checked = document.querySelector(`[name="${f.id}"]:checked`);
            if (checked) {
              answers[current][f.id] = checked.value;
            }
          } else {
            const el = document.querySelector(`[data-field="${f.id}"]`);
            if (el) {
              answers[current][f.id] = el.value.trim();
            }
          }
        });
      }
      if (current < total - 1){
        current++;
        renderQuestion();
      } else {
        renderResult();
        showSection(2);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    function prev(){ if (current > 0){ current--; renderQuestion(); } }
    function resetAll(){
      current = 0;
      answers = questions.map(q => q.multiple ? [] : null);
      showSection(1);
      renderQuestion();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========= ç¶å®š =========
    startQuizBtn.addEventListener('click', e => { e.preventDefault(); showSection(1); renderQuestion(); });
    nextBtn.addEventListener('click', next);
    prevBtn.addEventListener('click', prev);
    document.addEventListener('keydown', e => { if (step===1){ if (e.key==='ArrowRight') next(); if (e.key==='ArrowLeft') prev(); }});
    const yearEl = $('#year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();
    
    // çµæœé ã€Œé‡æ–°æ¸¬ä¸€æ¬¡ã€
    document.addEventListener('click', (e)=>{
      if (e.target && e.target.id === 'retryBtn') resetAll();
    });
    const GS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwceqE-L6apGfe2dv2rrAOu5Y8ElWr3q2ZYNHmmzf0ggb4DKUDjPKBym0KVGp4yPA/exec';

  // å–å¾—å–®é¡Œç­”æ¡ˆï¼šè¤‡é¸å›å‚³é™£åˆ—ï¼Œå–®é¸å›å‚³æ–‡å­—
  function getAnswer(q, qi) {
    if (q.multiple) return (answers[qi] || []).map(i => q.options[i]);
    const i = answers[qi];
    return (i != null ? q.options[i] : '');
  }

  // çµ„æˆè¦é€åˆ° Apps Script çš„ payload
function buildPayload() {
  const ranking = computeScores();
  const top = teachers.find(t => t.id === ranking[0]?.id);
  const topText = top ? `${top.name}ï¼ˆ${top.instrument}ï¼‰` : 'ç„¡';
  const top3 = (ranking || []).slice(0,3)
    .map((r,i)=>`${i+1}.${teachers.find(t=>t.id===r.id)?.name || r.id}(${r.score})`)
    .join(' / ');
  const match = `${topText}ï½œTop3ï¼š${top3}`;

  // å–åŸºæœ¬è³‡è¨Š
  const payload = { match };
  const basicFields = ["name", "gender", "job", "contact"];
  basicFields.forEach(id => {
    const el = document.querySelector(`[data-field="${id}"]`);
    if (el) {
      if (el.type === "radio") {
        const checked = document.querySelector(`[name="${id}"]:checked`);
        payload[id] = checked ? checked.value : "";
      } else {
        payload[id] = el.value.trim();
      }
    }
  });

// å–®ç¨è™•ç† note_field çš„ textarea
const noteFieldEl = document.querySelector(`[data-field="note"]`); // ç¢ºä¿é€™è£¡çš„ "note" èˆ‡ quiz_data.js ä¸­çš„ id ç›¸ç¬¦
if (noteFieldEl) {
    payload.note = noteFieldEl.value.trim();
}

  // æŠŠå•å·é¸é …ç­”æ¡ˆä¹Ÿè¨˜éŒ„ä¸‹ä¾†
  questions.forEach((q, idx) => {
    if (q.options) {
      payload[`q${q.id}`] = getAnswer(q, idx);
    }
  });

  return payload;
}

    // --- ä¿®æ­£çµæœé ã€Œé€å‡ºå•å·ã€æŒ‰éˆ•çš„é‚è¼¯ ---
    const submitQuestionBtn = document.getElementById('submitBtn'); // å–å¾—çµæœé çš„é€å‡ºæŒ‰éˆ•
    const statusMessageContainer = document.getElementById('contactStatus'); // å–å¾—ç”¨æ–¼é¡¯ç¤ºç‹€æ…‹çš„å…ƒç´ 

    // æª¢æŸ¥æŒ‰éˆ•æ˜¯å¦å­˜åœ¨
    if (submitQuestionBtn) {
        submitQuestionBtn.addEventListener('click', async () => {
            // ç¢ºä¿åœ¨é»æ“Šæ™‚ï¼Œæ‰€æœ‰è³‡æ–™éƒ½å·²æ­£ç¢ºå¡«å¯«ä¸¦å„²å­˜åˆ° answers é™£åˆ—ä¸­
            // (é€™éƒ¨åˆ†ç”± renderQuestion å’Œé¸é …çš„é»æ“Šäº‹ä»¶è™•ç†)

            // è™•ç†æŒ‰éˆ•ç‹€æ…‹ï¼Œé¿å…é‡è¤‡é€å‡º
            submitQuestionBtn.disabled = true;
            submitQuestionBtn.textContent = 'å‚³é€ä¸­...';
            if (statusMessageContainer) {
                statusMessageContainer.textContent = 'æ­£åœ¨å‚³é€è³‡æ–™...';
            }

            try {
                // 1. å–å¾—æœ€çµ‚çš„ payload
                const payload = buildPayload();
                console.log('payload =', payload); // é–‹ç™¼æ™‚æª¢æŸ¥è³‡æ–™

                // 2. ç™¼é€ fetch è«‹æ±‚åˆ° Apps Script
                const res = await fetch(GS_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': "application/json" },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();
                console.log('server response:', json);

                if (!json.ok) {
                    // å¦‚æœä¼ºæœå™¨å›å‚³éŒ¯èª¤
                    throw new Error(json.error || 'ä¼ºæœå™¨å›å‚³éŒ¯èª¤');
                }

                // 3. é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                if (statusMessageContainer) {
                    statusMessageContainer.textContent = 'è³‡æ–™å·²æˆåŠŸé€å‡ºï¼';
                }
                alert('å•å·å·²æˆåŠŸé€å‡ºï¼Œæˆ‘å€‘æœƒç›¡å¿«èˆ‡ä½ è¯çµ¡ï¼');

                // æˆåŠŸé€å‡ºå¾Œï¼Œå¯ä»¥å°å‘å…¶ä»–é é¢æˆ–é‡è¨­å•å·
                // ä¾‹å¦‚ï¼šå°å›é¦–é 
                // window.location.href = '#'; 
                // æˆ–è€…ï¼šé‡è¨­å•å·
                // resetAll(); 

            } catch (err) {
                console.error('é€å‡ºå¤±æ•—:', err);
                // é¡¯ç¤ºå¤±æ•—è¨Šæ¯
                if (statusMessageContainer) {
                    statusMessageContainer.textContent = 'é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚';
                }
                alert('é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            } finally {
                // ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                submitQuestionBtn.disabled = false;
                submitQuestionBtn.textContent = 'é€å‡ºå•å·';
            }
        });
    }


  </script>

      <!-- Contactæ”¾é å°¾ -->
<footer id="contact" class="card" style="margin:28px auto; background-color: #1a1a1a; /* è‡ªå®šç¾©ä¸€å€‹æ·±è‰²èƒŒæ™¯ï¼Œèˆ‡ä¸»é é¢èƒŒæ™¯å€éš” */">
  <div style="max-width: 900px; width: 100%; padding: 30px 20px; text-align: center; margin: 0 auto;">
    <p class="muted" style="margin-top:0; color: #aaa;">å°å—å¸‚æ±å€æ±å¯§è·¯è¥¿æ®µ22è™Ÿï½œ(06)236-7528</p>

    <div style="display:flex; gap:20px; flex-wrap:wrap; margin-top:20px; justify-content:center;">
      <a href="https://www.instagram.com/room2music/" target="_blank" style="width:56px; height:56px; display:flex; justify-content:center; align-items:center; background-color: #333; border-radius:12px; transition:transform 0.2s; cursor:pointer;">
        <img src="../../photo/instagram.png" alt="Instagram" style="width:48px; height:48px; object-fit:contain;">
      </a>
      <a href="https://www.facebook.com/ROOM2MUSIC/?locale=zh_TW" target="_blank" style="width:56px; height:56px; display:flex; justify-content:center; align-items:center; background-color: #333; border-radius:12px; transition:transform 0.2s; cursor:pointer;">
        <img src="../../photo/facebook.png" alt="Facebook" style="width:48px; height:48px; object-fit:contain;">
      </a>
      <a href="https://maps.app.goo.gl/xkhWrudjteqcfzjs9" target="_blank" style="width:56px; height:56px; display:flex; justify-content:center; align-items:center; background-color: #333; border-radius:12px; transition:transform 0.2s; cursor:pointer;">
        <img src="../../photo/googlemap.png" alt="Google Map" style="width:48px; height:48px; object-fit:contain;">
      </a>
    </div>
  </div>
</footer>
</body>
</html>
