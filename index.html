<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Room2Music</title>
  <style>
    :root { --bg:#f8fafc; --fg:#0f172a; --muted:#475569; --card:#fff; --border:#e2e8f0; --accent:#0f172a; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Noto Sans,"Helvetica Neue",Arial;color:var(--fg);background:linear-gradient(#fff,var(--bg))}
    .container{max-width:1040px;margin:0 auto;padding:24px}
    .hero{display:grid;grid-template-columns:1fr;gap:24px;padding:32px 0}
    @media(min-width:900px){.hero{grid-template-columns:1fr 1fr;align-items:center}}
    h1{font-size:clamp(28px,4vw,48px);margin:0 0 12px;font-weight:900}
    p.lead{font-size:18px;color:var(--muted);line-height:1.7}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:16px;padding:12px 18px;text-decoration:none;font-weight:600;border:1px solid var(--border)}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn:hover{filter:brightness(.96)}
    .btn[disabled]{opacity:.5;pointer-events:none}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .card.pad{padding:24px}
    .imgbox{aspect-ratio:16/9;width:100%;overflow:hidden;border-radius:16px;border:1px solid var(--border)}
    .imgbox img{width:100%;height:100%;object-fit:cover;display:block}
    .pills{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .pill{border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:#334155;background:#f8fafc}

    .progress{width:100%;height:8px;border-radius:999px;background:#e2e8f0;overflow:hidden}
    .progress>div{height:100%;background:var(--accent);width:0%;transition:width .25s ease}

    .options{display:grid;gap:12px}
    .option{ text-align:left;border:1px solid var(--border);border-radius:16px;padding:14px;background:#fff;cursor:pointer;display:flex;gap:12px;align-items:flex-start;box-shadow:0 1px 4px rgba(0,0,0,.04)}
    .option:hover{border-color:#cbd5e1}
    .option.selected{background:#0f172a;color:#fff;border-color:#0f172a}
    .option .num{width:24px;height:24px;border-radius:50%;border:1px solid #cbd5e1;display:inline-flex;align-items:center;justify-content:center;font-size:12px;background:#f1f5f9;color:#334155;margin-top:2px}
    .option.selected .num{background:#fff;color:#0f172a;border-color:transparent}

    .quiz-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:12px}

    .result-grid{display:grid;gap:24px;grid-template-columns:1fr}
    @media(min-width:900px){.result-grid{grid-template-columns:1fr 1fr}}
    .teacher-photo{width:100%;height:260px;object-fit:cover;border-bottom:1px solid var(--border);display:block}
    .runner{display:flex;gap:12px;align-items:center}
    .runner img{width:56px;height:56px;border-radius:12px;border:1px solid var(--border);object-fit:cover}
    .muted{color:var(--muted)}
    .fade-enter{opacity:0;transform:translateX(24px)}
    .fade-enter.active{opacity:1;transform:translateX(0);transition:all .2s ease}
    .fade-exit{opacity:1;transform:translateX(0)}
    .fade-exit.active{opacity:0;transform:translateX(-24px);transition:all .2s ease}
  </style>
</head>
<body>
  <div class="container">
    <!-- Hero -->
    <section class="hero">
      <div>
        <h1>Room2Music</h1>
        <h2>è²³é¤¨éŸ³æ¨‚</h2>
        <p class="lead">æˆ‘å€‘ç›¸ä¿¡ã€Œå¥½è€å¸«ï¼Œæœƒè®“ä½ æ›´æƒ³ç·´ã€ã€‚å¡«å¯« 60 ç§’å•å·ï¼Œç«‹åˆ»ç‚ºä½ ç²¾æº–é…å°æœ€åˆæ‹çš„è€å¸«èˆ‡èª²ç¨‹æ–¹å‘ã€‚</p>
        <div style="display:flex;gap:12px;margin-top:16px">
          <a href="#quiz" class="btn primary" id="startQuiz">é–‹å§‹ 60 ç§’é…å°</a>
          <a href="#contact" class="btn">è¯çµ¡æˆ‘å€‘</a>
        </div>
      </div>
      <div>
        <div class="imgbox">
          <img src="https://placehold.co/960x540?text=Music+School+Hero" alt="Music classroom">
        </div>
        <div class="pills">
          <span class="pill">é›»/æœ¨å‰ä»–</span><span class="pill">æµè¡Œ/çˆµå£«</span><span class="pill">æª¢å®š/æ¯”è³½</span><span class="pill">å…’ç«¥å‹å–„</span>
        </div>
      </div>
    </section>

    <!-- Quiz -->
    <section id="quizSection" class="card pad" style="display:none">
      <div style="margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;font-size:14px;color:var(--muted);margin-bottom:8px">
          <span>é€²åº¦</span><span id="progressText">1 / 9ï¼ˆ0%ï¼‰</span>
        </div>
        <div class="progress"><div id="progressBar"></div></div>
      </div>
      <div id="questionWrap"></div>
      <div class="quiz-nav">
        <button class="btn" id="prevBtn">ä¸Šä¸€é¡Œ</button>
        <button class="btn primary" id="nextBtn">ä¸‹ä¸€é¡Œ</button>
      </div>
    </section>

    <!-- Result -->
    <section id="resultSection" style="display:none">
      <div class="result-grid">
        <div class="card">
          <img id="topPhoto" class="teacher-photo" src="" alt="æœ€ä½³è€å¸«">
          <div class="pad">
            <h3 style="margin:0 0 6px;font-size:22px;font-weight:700">æœ€é©åˆä½ çš„è€å¸«</h3>
            <p id="topName" style="margin:0 0 10px;font-size:18px;font-weight:800"></p>
            <div id="topTags" class="pills" style="margin-bottom:10px"></div>
            <p id="topBio" class="muted" style="line-height:1.7"></p>
            <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
              <a href="#contact" class="btn primary">ç«‹åˆ»è¯çµ¡/é ç´„é«”é©—èª²</a>
              <button class="btn" id="retryBtn">é‡æ–°æ¸¬ä¸€æ¬¡</button>
            </div>
          </div>
        </div>
        <div class="card pad">
          <h4 style="margin:0 0 10px;font-size:18px;font-weight:700">æ¬¡ä½³äººé¸</h4>
          <div id="runnerList" style="display:grid;gap:12px"></div>
          <p class="muted" style="font-size:12px;margin-top:12px">* è‹¥æœ€é©åˆçš„æ™‚æ®µæ»¿ç­ï¼Œä»¥ä¸Šè€å¸«ä¹Ÿéå¸¸å¥‘åˆä½ çš„å­¸ç¿’åå¥½ã€‚</p>
        </div>
      </div>
    </section>

    <!-- Contactï¼ˆé¡åƒ Google è¡¨å–®ï¼‰ -->
    <form id="gform"
          class="card pad"
          style="margin:28px 0 10px"
          action="#"
          method="POST">

      <h3 style="margin:0 0 10px;font-size:22px;font-weight:800">è¯çµ¡æˆ‘å€‘</h3>
      <p class="muted" style="margin-top:0">åœ°å€ï¼šæ¡ƒåœ’å¸‚XXå€XXè·¯100è™Ÿï½œé›»è©±ï¼š(03) 123-4567ï½œLINEï¼š@musicschool</p>

      <div style="display:grid;gap:16px;grid-template-columns:1fr">
        <div>
          <label class="muted" style="font-size:14px">ä½ çš„å§“å</label>
          <!-- å§“åï¼šentry.465133692 -->
          <input id="nameInput"
                name="entry.465133692"
                placeholder="ç‹å°æ˜" required
                style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border)">
        </div>

        <div>
          <label class="muted" style="font-size:14px">è¯çµ¡æ–¹å¼ï¼ˆEmail / æ‰‹æ©Ÿï¼‰</label>
          <!-- è¯çµ¡æ–¹å¼ï¼šentry.331042393 -->
          <input id="contactInput"
                name="entry.331042393"
                placeholder="example@gmail.com" required
                style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border)">
        </div>

        <div>
          <label class="muted" style="font-size:14px">æƒ³å­¸çš„å…§å®¹/å‚™è¨»</label>
          <!-- å‚™è¨»ï¼šentry.90522651 -->
          <textarea id="noteInput"
                    name="entry.90522651"
                    placeholder="ä¾‹å¦‚ï¼šæƒ³å­¸æµè¡Œé‹¼ç´ã€ä¸Šèª²æ™‚é–“åå¥½é€±æœ«..."
                    style="margin-top:6px;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);height:120px"></textarea>
        </div>
        <div>
          <button type="submit" class="btn primary" style="width:100%;justify-content:center">é€å‡ºç•™è¨€</button>
          <p class="muted" style="font-size:12px;margin-top:8px">
            æœ¬é é¢ç‚ºç´”å‰ç«¯ï¼Œè³‡æ–™é€é Google Apps Script å®‰å…¨å¯«å…¥ä½ çš„ Google è©¦ç®—è¡¨ã€‚
          </p>
          <div id="contactStatus" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <div style="text-align:center;color:#6b7280;font-size:13px;margin-top:20px">
        Â© <span id="year"></span> room2Music â€” è®“å­¸éŸ³æ¨‚è®Šå¾—æ›´è¼•é¬†ã€‚
      </div>
    </form>


  </div>

  <!-- å¤–éƒ¨è³‡æ–™æª” -->
  <script src="assets/data/quiz_data.js"></script>

  <!-- ä¸»ç¨‹å¼ -->
  <script>
    const { questions, teachers } = window.quizData;

    // ========= ç‹€æ…‹ =========
    const $ = (s) => document.querySelector(s);
    const quizSection = $('#quizSection');
    const resultSection = $('#resultSection');
    const startQuizBtn = $('#startQuiz');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const progressBar = $('#progressBar');
    const progressText = $('#progressText');
    const questionWrap = $('#questionWrap');

    const total = questions.length;
    let step = 0;       // 0=hero, 1=quiz, 2=result
    let current = 0;    // ç›®å‰é¡Œè™Ÿ index
    // ç­”æ¡ˆé™£åˆ—ï¼šå–®é¸å­˜æ•¸å­— indexï¼›è¤‡é¸å­˜é™£åˆ— [index, index]
    let answers = questions.map(q => q.multiple ? [] : null);
    // ğŸ¯ æ¨‚å™¨åˆ†æµæ¬Šé‡ï¼ˆå¯è‡ªè¡Œå¾®èª¿ï¼‰
    const INSTRUMENT_WEIGHT_EXACT = 3;   // åŒå‹ï¼ˆä¾‹ï¼šé¸é›»å‰ä»– + é›»å‰ä»–è€å¸«ï¼‰
    const INSTRUMENT_WEIGHT_CROSS = 1;   // è·¨å‹ï¼ˆä¾‹ï¼šé¸é›»å‰ä»– + æœ¨å‰ä»–è€å¸«ï¼‰
    const INSTRUMENT_PREF_BONUS   = 2;   // è€å¸«åœ¨ preferences[1] åå¥½ä½ çš„æ¨‚å™¨ï¼Œå†åŠ æˆ
    const GUITAR_SET = new Set(["é›»å‰ä»–", "æœ¨å‰ä»–"]);
    

    // ========= UI =========
    function showSection(which){
      quizSection.style.display = which === 1 ? 'block' : 'none';
      resultSection.style.display = which === 2 ? 'block' : 'none';
      step = which;
    }

    function updateProgress(){
      const percent = Math.round(((current + 1) / total) * 100);
      progressBar.style.width = percent + '%';
      progressText.textContent = `${current + 1} / ${total}ï¼ˆ${percent}%ï¼‰`;
    }

    function renderQuestion(){
      updateProgress();
      const q = questions[current];
      const old = questionWrap.firstElementChild;
      if (old){
        old.className = 'fade-exit';
        requestAnimationFrame(()=>{ old.className = 'fade-exit active';
          setTimeout(()=>{ questionWrap.removeChild(old); pushNew(); }, 180);
        });
      } else { pushNew(); }
      function setNavState(q){
        prevBtn.disabled = current === 0;
        nextBtn.textContent = (current < total - 1) ? 'ä¸‹ä¸€é¡Œ' : 'çœ‹çµæœ';
        nextBtn.disabled = q.multiple
            ? !(answers[current] && answers[current].length > 0)
            : (answers[current] == null);
        }
      function pushNew(){
        const wrap = document.createElement('div');
        wrap.className = 'fade-enter';
        wrap.innerHTML = `
            <h2 style="margin:0 0 12px;font-size:24px;font-weight:800;">${q.title}</h2>
            <div class="options">
            ${q.options.map((label, i) => {
                const selected = q.multiple
                ? (answers[current] || []).includes(i)
                : answers[current] === i;
                return `
                <button class="option ${selected ? 'selected' : ''}"
                        data-index="${i}" aria-pressed="${selected}">
                    <span class="num">${i+1}</span>
                    <span>${label}</span>
                </button>`;
            }).join('')}
            </div>
        `;
        questionWrap.appendChild(wrap);
        requestAnimationFrame(()=>{ wrap.className = 'fade-enter active'; });

        // âœ… åªæ›´æ–°æ¨£å¼èˆ‡ç­”æ¡ˆï¼Œä¸å‘¼å« renderQuestion()ï¼Œé¿å…å‹•ç•«è§¸ç™¼
        const optionButtons = wrap.querySelectorAll('.option');
        optionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
            const i = Number(btn.getAttribute('data-index'));

            if (q.multiple) {
                // è¤‡é¸ï¼šåˆ‡æ›è©²æŒ‰éˆ•é¸å–ç‹€æ…‹
                const arr = Array.isArray(answers[current]) ? [...answers[current]] : [];
                const pos = arr.indexOf(i);
                const willSelect = pos === -1;
                if (willSelect) arr.push(i); else arr.splice(pos, 1);
                answers[current] = arr.sort((a,b)=>a-b);

                // æ›´æ–°è©²æŒ‰éˆ•æ¨£å¼èˆ‡ aria
                btn.classList.toggle('selected', willSelect);
                btn.setAttribute('aria-pressed', String(willSelect));
            } else {
                // å–®é¸ï¼šæ¸…æ‰å…¶ä»–çš„ selectedï¼Œåƒ…æ¨™è¨˜ç•¶å‰
                answers[current] = i;
                optionButtons.forEach(b => {
                const idx = Number(b.getAttribute('data-index'));
                const on = idx === i;
                b.classList.toggle('selected', on);
                b.setAttribute('aria-pressed', String(on));
                });
            }

            // ä¾ç›®å‰ç­”æ¡ˆç‹€æ…‹æ›´æ–°ã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•æ˜¯å¦å•Ÿç”¨
            setNavState(q);
            });
        });

        // åˆæ¬¡æ¸²æŸ“æ™‚è¨­å®šæŒ‰éˆ•ç‹€æ…‹
        setNavState(q);
        }
    }
    

    // ========= é…å°æ¼”ç®—æ³• =========
    // è¦å‰‡ï¼šæ¯ä¸€é¡Œï¼Œåªè¦ã€Œå­¸å“¡ç­”æ¡ˆã€åŒ…å«åœ¨è€å¸«è©²é¡Œçš„å¯æ¥å—æ¸…å–®ï¼Œå°±åŠ  1 åˆ†ã€‚
    // è¤‡é¸é¡Œï¼šæ¯å€‹ç¬¦åˆçš„é¸é …å„åŠ  1 åˆ†ï¼ˆå¤šé¸å¤šå¾—ï¼‰ã€‚
   function computeScores(){
      // ç¬¬ 1 é¡Œï¼ˆæ¨‚å™¨ï¼‰ä½œç‚ºåˆ†æµå‰æ
      const ansInstrumentIdx = answers[0]; // q1 ä¸€å®šæ˜¯ç¬¬ä¸€é¡Œ
      const instrumentLabel = ansInstrumentIdx != null ? questions[0].options[ansInstrumentIdx] : null;

      // å…ˆä¾æ¨‚å™¨æŒ‘å‡ºå€™é¸è€å¸«
      const candidates = teachers.filter(t => {
        if (!instrumentLabel) return true; // ç†è«–ä¸Šä¸æœƒç™¼ç”Ÿï¼ˆä¸‹ä¸€é¡Œå‰æœƒé–å®šï¼‰
        if (GUITAR_SET.has(instrumentLabel)) {
          // å‰ä»–çµ„ï¼šå…©é‚Šè€å¸«éƒ½å¯æ•™
          return GUITAR_SET.has(t.instrument);
        } else {
          // å…¶ä»–æ¨‚å™¨ï¼šè€å¸«å¿…é ˆèƒ½æ•™è©²æ¨‚å™¨æ‰ç´å…¥
          const canTeach = Array.isArray(t.canTeach)
            ? t.canTeach.includes(instrumentLabel)
            : (t.instrument === instrumentLabel);
          return canTeach;
        }
      });

      // å°å€™é¸è€å¸«è¨ˆåˆ†
      const scoreList = candidates.map(t => {
        let score = 0;

        // 1) æ¨‚å™¨åŠ æ¬Šï¼ˆåªåœ¨æœ‰é¸ç¬¬ 1 é¡Œæ™‚ï¼‰
        if (instrumentLabel) {
          // åŒ/è·¨å‹åŠ æ¬Š
          if (GUITAR_SET.has(instrumentLabel)) {
            score += (t.instrument === instrumentLabel)
              ? INSTRUMENT_WEIGHT_EXACT
              : INSTRUMENT_WEIGHT_CROSS;
          } else {
            // éå‰ä»–ï¼šå€™é¸éƒ½å·²èƒ½æ•™ -> çµ¦åŒå‹é«˜åˆ†
            score += (t.instrument === instrumentLabel)
              ? INSTRUMENT_WEIGHT_EXACT
              : INSTRUMENT_WEIGHT_CROSS; // ä½ ä¹Ÿå¯è¨­ç‚º 0
          }
          // åå¥½åŠ æˆï¼šè€å¸«åœ¨ç¬¬ 1 é¡Œ preferences å…§åŒ…å«æ­¤æ¨‚å™¨é¸é …ï¼ˆ1-basedï¼‰
          const pref1 = t.preferences?.[1];
          if (pref1 && pref1.includes(ansInstrumentIdx + 1)) {
            score += INSTRUMENT_PREF_BONUS;
          }
        }

        // 2) å…¶ä»–é¡Œï¼ˆ2ï½9ï¼‰ç…§èˆŠåŠ åˆ†ï¼›ç¬¬ 1 é¡Œä¸å†ç•¶ä¸€èˆ¬é¡Œç›®è¨ˆåˆ†
        questions.forEach((q, qi) => {
          if (q.id === 1) return; // è·³éæ¨‚å™¨é¡Œ
          const accept = t.preferences[q.id];
          if (!accept) return;
          const ans = answers[qi];
          if (q.multiple) {
            (ans || []).forEach(idx => {
              if (accept.includes(idx + 1)) score += 1;
            });
          } else {
            if (ans != null && accept.includes(ans + 1)) score += 1;
          }
        });

        return { id: t.id, score };
      });

      // ä¾åˆ†æ•¸æ’åºï¼ˆè‹¥å®Œå…¨æ²’æœ‰å€™é¸ï¼Œå›å‚³ç©ºé™£åˆ—ï¼‰
      scoreList.sort((a,b) => b.score - a.score);
      return scoreList;
    }


    function renderResult(){
      const ranking = computeScores();
      const top = teachers.find(t => t.id === ranking[0]?.id);
      const ansInstrumentIdx = answers[0];
      const instrumentLabel = ansInstrumentIdx != null ? questions[0].options[ansInstrumentIdx] : null;

      // è‹¥æ²’æ‰¾åˆ°è€å¸«ï¼Œçµ¦å‡ºé‡å°æ€§èªªæ˜
      if (!top) {
        const topName = document.getElementById('topName');
        const topBio  = document.getElementById('topBio');
        if (topName) topName.textContent = 'æš«ç„¡å°æ‡‰è€å¸«';
        if (topBio)  topBio.textContent  = instrumentLabel
          ? `ç›®å‰å°šç„¡ã€Œ${instrumentLabel}ã€å°æ‡‰çš„è€å¸«ï¼Œæ­¡è¿å…ˆç•™è¨€ï¼Œæˆ‘å€‘æœƒå”åŠ©å®‰æ’æˆ–æ¨è–¦ã€‚`
          : 'ç›®å‰æš«ç„¡æ¨è–¦ï¼Œè«‹èª¿æ•´ä½œç­”æ¢ä»¶å†è©¦ä¸€æ¬¡ã€‚';
      }
      const runners = ranking.slice(1,3).map(r => teachers.find(t => t.id === r.id));

      // Top
      const topPhoto = $('#topPhoto');
      const topName = $('#topName');
      const topBio  = $('#topBio');
      const topTags = $('#topTags');

      topPhoto.src = top?.photo || 'https://placehold.co/600x400?text=Teacher';
      topPhoto.alt = top?.name || 'æœ€ä½³è€å¸«';
      topName.textContent = top?.name || 'æš«ç„¡æ¨è–¦';
      topBio.textContent  = top
        ? `æˆèª²æ¨‚å™¨ï¼š${top.instrument}ï½œï¼ˆå¯è¯çµ¡æˆ‘å€‘å®‰æ’é«”é©—èª²ï¼‰`
        : 'è«‹èª¿æ•´ä½ çš„ä½œç­”æ¢ä»¶å†è©¦ä¸€æ¬¡ã€‚';
      topTags.innerHTML = '';
      // é€™è£¡å¯è‡ªç”±æ”¾æ¨™ç±¤ï¼ˆç¤ºæ„ï¼šè€å¸«æ¨‚å™¨èˆ‡æ€§åˆ¥ï¼‰
      if (top){
        ["#"+top.instrument, top.gender ? "æ€§åˆ¥ï¼š"+top.gender : null]
          .filter(Boolean)
          .forEach(tag=>{
            const el = document.createElement('span');
            el.className = 'pill';
            el.textContent = tag;
            topTags.appendChild(el);
          });
      }

      // Runners
      const runnerList = $('#runnerList');
      runnerList.innerHTML = '';
      runners.forEach(r => {
        if (!r) return;
        const row = document.createElement('div');
        row.className = 'runner';
        row.innerHTML = `
          <img src="${r.photo || 'https://placehold.co/96x96?text=T'}" alt="${r.name}">
          <div>
            <div style="font-weight:600">${r.name}</div>
            <div class="muted" style="font-size:13px">æˆèª²æ¨‚å™¨ï¼š${r.instrument}</div>
          </div>`;
        runnerList.appendChild(row);
      });
    }

    // ========= å°èˆª =========
    function next(){
      if (current < total - 1){
        current++;
        renderQuestion();
      } else {
        renderResult();
        showSection(2);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    function prev(){ if (current > 0){ current--; renderQuestion(); } }
    function resetAll(){
      current = 0;
      answers = questions.map(q => q.multiple ? [] : null);
      showSection(1);
      renderQuestion();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========= ç¶å®š =========
    startQuizBtn.addEventListener('click', e => { e.preventDefault(); showSection(1); renderQuestion(); });
    nextBtn.addEventListener('click', next);
    prevBtn.addEventListener('click', prev);
    document.addEventListener('keydown', e => { if (step===1){ if (e.key==='ArrowRight') next(); if (e.key==='ArrowLeft') prev(); }});
    
    $('#year').textContent = new Date().getFullYear();
    // çµæœé ã€Œé‡æ–°æ¸¬ä¸€æ¬¡ã€
    document.addEventListener('click', (e)=>{
      if (e.target && e.target.id === 'retryBtn') resetAll();
    });
    const GS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbyo4x1NhH7JkC6QVzXFt5Rh-TSxqHX4L2vH2FRjowmy8d59k7GdZyOTIiyQyqk-Q9Lx1w/exec';

  // å–å¾—å–®é¡Œç­”æ¡ˆï¼šè¤‡é¸å›å‚³é™£åˆ—ï¼Œå–®é¸å›å‚³æ–‡å­—
  function getAnswer(q, qi) {
    if (q.multiple) return (answers[qi] || []).map(i => q.options[i]);
    const i = answers[qi];
    return (i != null ? q.options[i] : '');
  }

  // çµ„æˆè¦é€åˆ° Apps Script çš„ payload
  function buildPayload() {
      const ranking = computeScores();
      const top = teachers.find(t => t.id === ranking[0]?.id);
      const topText = top ? `${top.name}ï¼ˆ${top.instrument}ï¼‰` : 'ç„¡';
      const top3 = (ranking || []).slice(0,3)
        .map((r,i)=>`${i+1}.${teachers.find(t=>t.id===r.id)?.name || r.id}(${r.score})`)
        .join(' / ');
      const match = `${topText}ï½œTop3ï¼š${top3}`;

      return {
        name: document.getElementById('nameInput').value.trim(),
        contact: document.getElementById('contactInput').value.trim(),
        note: document.getElementById('noteInput').value.trim(),
        match,
        q1:getAnswer(questions[0],0), q2:getAnswer(questions[1],1), q3:getAnswer(questions[2],2),
        q4:getAnswer(questions[3],3), q5:getAnswer(questions[4],4), q6:getAnswer(questions[5],5),
        q7:getAnswer(questions[6],6), q8:getAnswer(questions[7],7), q9:getAnswer(questions[8],8)
      };
    }

      // é€å‡ºåˆ° Apps Scriptï¼ˆJSONï¼›ç”¨ text/plain é¿é–‹é æª¢ï¼‰
      (() => {
        const form = document.getElementById('gform');
        if (!form) return;
        const statusBox = document.getElementById('contactStatus');
        const submitBtn = form.querySelector('button[type="submit"]');
        let submitting = false;

        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (submitting) return;
          submitting = true;

          try {
            if (submitBtn) submitBtn.disabled = true;
            if (statusBox) statusBox.textContent = 'å‚³é€ä¸­â€¦';

            const payload = buildPayload();
            console.log('payload =', payload); // â† é–‹ç™¼æ™‚çœ‹çœ‹æ˜¯å¦éƒ½æœ‰å€¼

            const res = await fetch(GS_ENDPOINT, {
              method: 'POST',
              headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // é—œéµï¼šç°¡æ˜“è«‹æ±‚
              body: JSON.stringify(payload)
            });

            const json = await res.json();   // ä½ çš„ doPost æœƒå›å‚³ { ok:true, data:{...} }
            console.log('server says:', json);
            if (!json.ok) throw new Error(json.error || 'server error');

            if (statusBox) statusBox.textContent = 'å·²é€å‡ºï¼Œæˆ‘å€‘æœƒç›¡å¿«èˆ‡ä½ è¯çµ¡ï¼';
            form.reset();

          } catch (err) {
            console.error(err);
            if (statusBox) statusBox.textContent = 'é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ”¹ç”¨ LINE è¯çµ¡æˆ‘å€‘ã€‚';
          } finally {
            if (submitBtn) submitBtn.disabled = false;
            submitting = false;
          }
        });
      })();


  </script>
</body>
</html>
